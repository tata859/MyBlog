<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>主页</title>
    <link rel="stylesheet" href="../inputTags.css">
    <script src="../layui/layui.js"></script>
    <script src="../inputTags.js"></script>
    <link rel="stylesheet" href="../css/origin.css">
    <link rel="stylesheet" href="../less/index.css">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
</head>
<body>
<div class="layui-tab">
    <ul class=" layui-nav" lay-filter="">
        <li class="layui-nav-item " ><a href="javascript:;">首页</a></li>
        <li class="layui-nav-item "><a href="javascript:;">论坛</a></li>

        <li class="layui-nav-item layui-this"><a href="#">发表文章</a></li>
        <li class="layui-nav-item"><a href="javascript:;">查找文章</a></li>
        <li id="my-content">
            <div class="Head-portrait "><img src="../images/1.jpg" alt=""></div>
            <ul  id="layui-nav-child"> <!-- 二级菜单 -->
                <li><a href="userInfo" target="_blank">个人信息</a></li>
                <li><a href="javascript:" target="_blank">我的文章</a></li>
                <li><a href="logonout">退出登录</a></li>
            </ul>
            <div class="muen ">
                <ul  id="button"> <!-- 二级菜单 -->
                    <li><a href="/logon">登陆</a></li>
                    <li><a href="/register">注册</a></li>
                </ul>
            </div>
        </li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item ">
            </div>
        <div class="layui-tab-item">内容2</div>
        <div class="layui-tab-item layui-show">
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">标题</label>
                    <div class="layui-input-block" style="max-width:800px;">
                        <input type="text" name="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">分类</label>
                    <div class="tags" id="tags" style="float: left;max-width:800px;min-height: 30px;margin: 0;padding: 1px;">
                        <input type="text" name="inputTags" id="inputTags"  placeholder="回车生成标签" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">内容</label>
                    <div style="max-width:800px;height: 350px;margin-left: 108px;"><textarea id="demo"  required style="display: none;"></textarea></div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <div class="layui-btn" lay-submit lay-filter="article">立即提交</div>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="layui-tab-item select">
            内容4
        </div>
    </div>
</div>
<script>
    //注意：导航 依赖 element 模块，否则无法进行功能性操作
    layui.use(['element','layedit','form','inputTags'],function(){
        var element = layui.element;
        var inputTags = layui.inputTags;
        var layedit = layui.layedit;
        var form = layui.form;
        var $=layui.$;
        var index = layedit.build("demo")
        //layedit.build('demo'); //建立编辑器
        inputTags.render({
            elem:'#inputTags',//定义输入框input对象

        })
        //监听提交
        form.on('submit(article)', function(data){
            let $tags=$("#tags span em"),
                tags=[];
            $tags.each(function () {
                tags.push($(this).text())
            })
            let postdata={
                title:data.field.title,
                tags:tags.toString(),
                content:layedit.getText(index),
            }
            $.ajax({
                method:"POST",
                url:"/article",
                data:postdata,
                success:function (date) {
                    layer.alert(date.msg,function () {
                        if(date.code===1){
                            location.href="/"
                        }
                        else {
                            layer.close(layer.index)
                        }
                    })
                }
            })
            return false;
        });

    })
</script>

<script>
    (function () {
        //头像ajax
        let $mycontent=$("#my-content"),
            $muen = $("#my-content .muen")
            $layuinavchild = $("#layui-nav-child");
        $mycontent.hover(function () {
            $.ajax({
                method:"post",
                url:"/usercenter",
                success:function (data) {
                     if(data.code===1){
                             $layuinavchild.addClass("layui-show")
                             $muen.removeClass("layui-show")

                         }else {
                         $muen.addClass("layui-show")
                         $layuinavchild.removeClass("layui-show")
                         }
                     }
                })
            },function () {
                $layuinavchild.removeClass("layui-show");
                $muen.removeClass("layui-show");
        });
        //导航栏clic事件
        let $layuiNavItem=$(".layui-nav-item");
        let $layuiTabItem=$(".layui-tab-item");
        //for (let i=0;i<$layuiNavItem.length;i++) {
            $layuiNavItem.click(function () {
                $layuiTabItem.removeClass("layui-show");
                let index=$(this).index();
                $layuiTabItem[index].classList.add("layui-show")
            })
        //}
    })()
</script>
</div>
</body>
</html>